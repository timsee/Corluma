# Corluma

Corluma is a cross-platform GUI designed to control Phillips Hue lights, Corsair RGB Keyboards, and arduino sketches from the [RGB-LED-Routines project](https://github.com/timsee/RGB-LED-Routines). It supports Windows, Linux, Mac OS X, Android, and iOS. It requires on Qt5.2 or later and C++11.

![Color Page](docs/resources/colorPagePreview.png "Color Page") ![Connection Page](docs/resources/connectionPagePreview.png  "Connection Page") ![Discovery Page](docs/resources/discoveryPagePreview.png  "Discovery Page")

## <a name="documentation">Documentation</a>

*  [Frontend Overview](https://timsee.github.io/Corluma/html/front_overview.html)
*  [Backend Overview](https://timsee.github.io/Corluma/html/backend_overview.html)

### <a name="hardware-comm">Communication With Hardware</a>

![Hardware Communication](docs/resources/CorlumaMessagingProtocol.png "Hardware Communication")

In order to make it easier to integrate different hardware with a variety of protocols into one system, there are a couple of layers of abstraction that all communication packets go through. The core systems used in commuincation are the `CommLayer`, the `DataLayer`, and the `DataSyncThreads`. The `DataLayer` holds all the users desired states for lights. If the user presses the off button for one light, and changes another RGB light to orange, both of these desired states are stored in the `DataLayer`. The `CommLayer` stores the actual states of the various lights. So if a Phillips Bridge updates that a light is currently as green as it can be, this data is stored in the CommLayer. This system is also responsible for converting messages from Corluma's protocols to other protocols such as the Phillips protocol. `DataSync Threads` are threads that wake up when the `DataLayer` changes and check the `DataLayer` against the `CommLayer` and, when necessary, it constructs packets in Corluma's protocols that are given to the `CommLayer` to send to the various lighting hardware. `DataSync Threads` either go to sleep when the states in the `CommLayer` exactly match the states in the `DataLayer` or when they encounter hardware failure for a light (for example, the light is off and cannot be reached). 

## <a name="mobile-support">Mobile Builds</a>

The GUI makes use of Qt5's support for Android and iOS.

The mobile application can also control Phillips Hues and can control HTTP and UDP samples from [RGB-LED-Routine](https://github.com/timsee/Corluma). It cannot be used with the serial samples, since mobile phones aren't designed to interface
with serial ports. 

The screen orientation for mobile devices will support portrait and landscape for tablets with an aspect 
ratio of 4:3, such as an iPad. For phones and thinner tablets, only portrait will be supported.

There are a couple of known issues with our current mobile support:

* In Qt versions before iOS 5.5.2, there is a compatibility issue with Apple's bitcode setting. 
To get around this, either install a more recent version of Qt, or go into the Xcodeproj generated by 
Qt Creator and change the enable bitcode setting to off. For more information, [check here](http://lists.qt-project.org/pipermail/interest/2015-October/019393.html). 
* Android 7.0 has compatibility issues with QSslSocket, due to dropping support for openssl in favor boringssl. Either recompile Qt from source to not support SSL, or compile your own version of libssl.so and libcrypto.so. To do the latter, check the [Qt Documentation](http://doc.qt.io/qt-5/opensslsupport.html).
* The first load of the android version of the application has some issues with its stylesheet. To fix, reload the application. 

## <a name="credits">Credits</a>

* The color wheel's image asset was created by a modified version of the [Python Color Gamut Generator](https://github.com/jacksongabbard/Python-Color-Gamut-Generator) by Jackson Gabbard.
* Code solutions taken from stackoverflow contain links to the original solutions in the source code. 


