<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Corluma: datasync.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="CSS_Corluma.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Corluma
   &#160;<span id="projectnumber">v0.19.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_d0537398ec3fe72d8d4f5c6709d28acc.html">comm</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">datasync.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef DATASYNC_H</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#define DATASYNC_H</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;cor/lightlist.h&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="struct_s_throttle.html">   20</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_s_throttle.html">SThrottle</a> {</div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="struct_s_throttle.html#aa7dbcc22f48a05598d862445f4ec4f43">   24</a></span>&#160;    QTime <a class="code" href="struct_s_throttle.html#aa7dbcc22f48a05598d862445f4ec4f43">time</a>;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="struct_s_throttle.html#aca1f2cd2944d7e6ec440626f8e3d51c0">   28</a></span>&#160;    QString <a class="code" href="struct_s_throttle.html#aca1f2cd2944d7e6ec440626f8e3d51c0">controller</a>;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="struct_s_throttle.html#a7d661746123c75dd511ae1005aff20b4">   32</a></span>&#160;    ECommType <a class="code" href="struct_s_throttle.html#a7d661746123c75dd511ae1005aff20b4">type</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;};</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">enum class</span> EDataSyncType { arducor, <a class="code" href="namespacehue.html">hue</a>, nanoleaf, settings };</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;Q_DECLARE_METATYPE(EDataSyncType)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">class </span><a class="code" href="class_comm_layer.html">CommLayer</a>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="class_data_sync.html">   53</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_data_sync.html">DataSync</a> {</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">virtual</span> ~<a class="code" href="class_data_sync.html">DataSync</a>() = <span class="keywordflow">default</span>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> cancelSync() = 0;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">public</span> slots:</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> resetSync() = 0;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> commPacketReceived(EProtocolType) = 0;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">protected</span> slots:</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> syncData() = 0;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> cleanupSync() = 0;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> endOfSync() = 0;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="class_data_sync.html#a9af4ff12861eeb642c46f5b8e1a5eb1e">  102</a></span>&#160;    EDataSyncType <a class="code" href="class_data_sync.html#a9af4ff12861eeb642c46f5b8e1a5eb1e">mType</a>;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="class_data_sync.html#a72dc9a5476a3ba4948129a22b6397824">  108</a></span>&#160;    <a class="code" href="classcor_1_1_light_list.html">cor::LightList</a>* <a class="code" href="class_data_sync.html#a72dc9a5476a3ba4948129a22b6397824">mData</a>;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="class_data_sync.html#a369794bb01f1bd5a2bd2b1c50d27c140">  114</a></span>&#160;    <a class="code" href="class_comm_layer.html">CommLayer</a>* <a class="code" href="class_data_sync.html#a369794bb01f1bd5a2bd2b1c50d27c140">mComm</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="class_data_sync.html#a563827bdc80eb6a167924ac6eb4b9328">  119</a></span>&#160;    QTimer* <a class="code" href="class_data_sync.html#a563827bdc80eb6a167924ac6eb4b9328">mSyncTimer</a>;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="class_data_sync.html#a0cfcaf3f0a1bc051962869b3d6368700">  124</a></span>&#160;    QTimer* <a class="code" href="class_data_sync.html#a0cfcaf3f0a1bc051962869b3d6368700">mCleanupTimer</a>;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="class_data_sync.html#a67d1274e16e3532f30d3dc945ca00a5a">  130</a></span>&#160;    QTime <a class="code" href="class_data_sync.html#a67d1274e16e3532f30d3dc945ca00a5a">mCleanupStartTime</a>;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="class_data_sync.html#a5d6d408e7359357995b7b2b93c3e5884">  136</a></span>&#160;    QTime <a class="code" href="class_data_sync.html#a5d6d408e7359357995b7b2b93c3e5884">mStartTime</a>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="class_data_sync.html#a67e7799828fe162f85145bd216695626">  142</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_data_sync.html#a67e7799828fe162f85145bd216695626">mDataIsInSync</a>;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="class_data_sync.html#ae262394c2ea78e041b895b4a9f633553">  147</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_data_sync.html#ae262394c2ea78e041b895b4a9f633553">mUpdateInterval</a>;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> sync(<span class="keyword">const</span> <a class="code" href="classcor_1_1_light.html">cor::Light</a>&amp; dataDevice, <span class="keyword">const</span> <a class="code" href="classcor_1_1_light.html">cor::Light</a>&amp; commDevice) = 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="comment">//------------------</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// Helpers</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">//------------------</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">bool</span> appendToPacket(QString&amp; currentPacket, <span class="keyword">const</span> QString&amp; newAddition, uint32_t maxPacketSize);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">float</span> ctDifference(<span class="keywordtype">float</span> first, <span class="keywordtype">float</span> second);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">//------------------</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// Throttle</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">//------------------</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="class_data_sync.html#a68e8b48b9ff470b9596f1f27b2b94e21">  189</a></span>&#160;    std::vector&lt;SThrottle&gt; <a class="code" href="class_data_sync.html#a68e8b48b9ff470b9596f1f27b2b94e21">mThrottleList</a>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordtype">bool</span> checkThrottle(<span class="keyword">const</span> QString&amp; <a class="code" href="struct_s_throttle.html#aca1f2cd2944d7e6ec440626f8e3d51c0">controller</a>, ECommType <a class="code" href="struct_s_throttle.html#a7d661746123c75dd511ae1005aff20b4">type</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">void</span> resetThrottle(<span class="keyword">const</span> QString&amp; <a class="code" href="struct_s_throttle.html#aca1f2cd2944d7e6ec440626f8e3d51c0">controller</a>, ECommType <a class="code" href="struct_s_throttle.html#a7d661746123c75dd511ae1005aff20b4">type</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;};</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#endif // DATASYNC_H</span></div><div class="ttc" id="namespacehue_html"><div class="ttname"><a href="namespacehue.html">hue</a></div><div class="ttdef"><b>Definition:</b> bridge.cpp:13</div></div>
<div class="ttc" id="class_comm_layer_html"><div class="ttname"><a href="class_comm_layer.html">CommLayer</a></div><div class="ttdoc">The CommLayer class provides communication protocols that allow the user to connect and send packets ...</div><div class="ttdef"><b>Definition:</b> commlayer.h:50</div></div>
<div class="ttc" id="struct_s_throttle_html_a7d661746123c75dd511ae1005aff20b4"><div class="ttname"><a href="struct_s_throttle.html#a7d661746123c75dd511ae1005aff20b4">SThrottle::type</a></div><div class="ttdeci">ECommType type</div><div class="ttdoc">type communication type for controller. </div><div class="ttdef"><b>Definition:</b> datasync.h:32</div></div>
<div class="ttc" id="class_data_sync_html_a72dc9a5476a3ba4948129a22b6397824"><div class="ttname"><a href="class_data_sync.html#a72dc9a5476a3ba4948129a22b6397824">DataSync::mData</a></div><div class="ttdeci">cor::LightList * mData</div><div class="ttdoc">mData pointer to data layer. Used for checking what state the data layer desires the devices to be...</div><div class="ttdef"><b>Definition:</b> datasync.h:108</div></div>
<div class="ttc" id="class_data_sync_html_a68e8b48b9ff470b9596f1f27b2b94e21"><div class="ttname"><a href="class_data_sync.html#a68e8b48b9ff470b9596f1f27b2b94e21">DataSync::mThrottleList</a></div><div class="ttdeci">std::vector&lt; SThrottle &gt; mThrottleList</div><div class="ttdoc">mThrottleList list of all known controllers that packets have been sent to and the the last time a pa...</div><div class="ttdef"><b>Definition:</b> datasync.h:189</div></div>
<div class="ttc" id="classcor_1_1_light_list_html"><div class="ttname"><a href="classcor_1_1_light_list.html">cor::LightList</a></div><div class="ttdoc">The LightList class stores and maintains a list of lights and their desired states. This object is used for storing what the user wants the lights to be. It also has some helper functions that generalize the state of lights. For instance, theres a brightness function that looks at the brightness of all lights in the list and returns an average. </div><div class="ttdef"><b>Definition:</b> lightlist.h:28</div></div>
<div class="ttc" id="class_data_sync_html_ae262394c2ea78e041b895b4a9f633553"><div class="ttname"><a href="class_data_sync.html#ae262394c2ea78e041b895b4a9f633553">DataSync::mUpdateInterval</a></div><div class="ttdeci">int mUpdateInterval</div><div class="ttdoc">mUpdateInterval number of milliseconds between each sync routine. </div><div class="ttdef"><b>Definition:</b> datasync.h:147</div></div>
<div class="ttc" id="class_data_sync_html_a369794bb01f1bd5a2bd2b1c50d27c140"><div class="ttname"><a href="class_data_sync.html#a369794bb01f1bd5a2bd2b1c50d27c140">DataSync::mComm</a></div><div class="ttdeci">CommLayer * mComm</div><div class="ttdoc">mComm pointer to comm layer. Used for checking what state the comm layer thinks the devices are in an...</div><div class="ttdef"><b>Definition:</b> datasync.h:114</div></div>
<div class="ttc" id="struct_s_throttle_html"><div class="ttname"><a href="struct_s_throttle.html">SThrottle</a></div><div class="ttdoc">The SThrottle struct tracks the last itme an individual controller was throttled. In the current iter...</div><div class="ttdef"><b>Definition:</b> datasync.h:20</div></div>
<div class="ttc" id="class_data_sync_html_a5d6d408e7359357995b7b2b93c3e5884"><div class="ttname"><a href="class_data_sync.html#a5d6d408e7359357995b7b2b93c3e5884">DataSync::mStartTime</a></div><div class="ttdeci">QTime mStartTime</div><div class="ttdoc">mStartTime time that sync thread was started so in case something groes wrong it can still timeout af...</div><div class="ttdef"><b>Definition:</b> datasync.h:136</div></div>
<div class="ttc" id="class_data_sync_html_a67d1274e16e3532f30d3dc945ca00a5a"><div class="ttname"><a href="class_data_sync.html#a67d1274e16e3532f30d3dc945ca00a5a">DataSync::mCleanupStartTime</a></div><div class="ttdeci">QTime mCleanupStartTime</div><div class="ttdoc">mCleanupStartTime time that sync the cleanup thread was started so that we know when to end it...</div><div class="ttdef"><b>Definition:</b> datasync.h:130</div></div>
<div class="ttc" id="class_data_sync_html_a0cfcaf3f0a1bc051962869b3d6368700"><div class="ttname"><a href="class_data_sync.html#a0cfcaf3f0a1bc051962869b3d6368700">DataSync::mCleanupTimer</a></div><div class="ttdeci">QTimer * mCleanupTimer</div><div class="ttdoc">mCleanupTimer timer for the cleanup thread. </div><div class="ttdef"><b>Definition:</b> datasync.h:124</div></div>
<div class="ttc" id="struct_s_throttle_html_aa7dbcc22f48a05598d862445f4ec4f43"><div class="ttname"><a href="struct_s_throttle.html#aa7dbcc22f48a05598d862445f4ec4f43">SThrottle::time</a></div><div class="ttdeci">QTime time</div><div class="ttdoc">time time since last message was sent. </div><div class="ttdef"><b>Definition:</b> datasync.h:24</div></div>
<div class="ttc" id="class_data_sync_html"><div class="ttname"><a href="class_data_sync.html">DataSync</a></div><div class="ttdoc">The DataSync base class is used for datasync threads. These threads compares the LightList&amp;#39;s represen...</div><div class="ttdef"><b>Definition:</b> datasync.h:53</div></div>
<div class="ttc" id="class_data_sync_html_a67e7799828fe162f85145bd216695626"><div class="ttname"><a href="class_data_sync.html#a67e7799828fe162f85145bd216695626">DataSync::mDataIsInSync</a></div><div class="ttdeci">bool mDataIsInSync</div><div class="ttdoc">mDataIsInSync true if all the datalayer and commlayer representations of devices are identical...</div><div class="ttdef"><b>Definition:</b> datasync.h:142</div></div>
<div class="ttc" id="class_data_sync_html_a563827bdc80eb6a167924ac6eb4b9328"><div class="ttname"><a href="class_data_sync.html#a563827bdc80eb6a167924ac6eb4b9328">DataSync::mSyncTimer</a></div><div class="ttdeci">QTimer * mSyncTimer</div><div class="ttdoc">mSyncTimer Whenever data is not in sync, </div><div class="ttdef"><b>Definition:</b> datasync.h:119</div></div>
<div class="ttc" id="classcor_1_1_light_html"><div class="ttname"><a href="classcor_1_1_light.html">cor::Light</a></div><div class="ttdoc">The Light class is the base datatype used for working with lights in Corluma. At a minimum...</div><div class="ttdef"><b>Definition:</b> light.h:29</div></div>
<div class="ttc" id="struct_s_throttle_html_aca1f2cd2944d7e6ec440626f8e3d51c0"><div class="ttname"><a href="struct_s_throttle.html#aca1f2cd2944d7e6ec440626f8e3d51c0">SThrottle::controller</a></div><div class="ttdeci">QString controller</div><div class="ttdoc">controller name of controller. </div><div class="ttdef"><b>Definition:</b> datasync.h:28</div></div>
<div class="ttc" id="class_data_sync_html_a9af4ff12861eeb642c46f5b8e1a5eb1e"><div class="ttname"><a href="class_data_sync.html#a9af4ff12861eeb642c46f5b8e1a5eb1e">DataSync::mType</a></div><div class="ttdeci">EDataSyncType mType</div><div class="ttdoc">type for this specific instance of the DataSync </div><div class="ttdef"><b>Definition:</b> datasync.h:102</div></div>
</div><!-- fragment --></div><!-- contents -->

<hr>
<table style="width:100%">
  <tr>
    <td>
      <p align="left">
      <small>
          &nbsp; &nbsp; Corluma Copyright 2015 - 2020  &nbsp; &nbsp; <br>
          &nbsp; &nbsp; All Rights GPL v3.0 Licensed.  &nbsp; &nbsp;
       </small>
       </p>
    </td>
    <td>
      <p align="right">
      <small>
          &nbsp; &nbsp;  Generated by doxygen &nbsp; &nbsp;
       </small>
       </p>
    </td>
  </tr>
</table>
